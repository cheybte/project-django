{% extends 'base.html' %}

{% block title %}
<title>Dashboard - Analyse des Prix</title>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center my-4">Analyse des Prix</h1>

    <div class="row">
        <div class="col-md-6">
            <h3>√âvolution de l'INPC sur plusieurs mois</h3>
            <canvas id="lineChart"></canvas>
        </div>
        <div class="col-md-6">
            <h3>R√©partition des prix par cat√©gorie de produit</h3>
            <canvas id="pieChart"></canvas>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <h3>Comparaison des prix moyens par produit</h3>
            <canvas id="barChart"></canvas>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("üìä Donn√©es charg√©es :", JSON.parse('{{ line_chart_data|safe }}'));

        // LINE CHART
        const lineCtx = document.getElementById('lineChart').getContext('2d');
        const lineChartData = JSON.parse('{{ line_chart_data|escapejs }}');
        const labels = ["Jan", "F√©v", "Mar", "Avr", "Mai", "Juin", "Juil", "Ao√ªt", "Sep", "Oct", "Nov", "D√©c"];

        const lineDatasets = Object.keys(lineChartData).map((key, index) => ({
            label: key,
            data: lineChartData[key],
            borderColor: `hsl(${index * 60}, 70%, 50%)`,
            borderWidth: 2,
            fill: false
        }));

        new Chart(lineCtx, {
            type: 'line',
            data: { labels: labels, datasets: lineDatasets },
            options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });

        // PIE CHART
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        const pieChartData = JSON.parse('{{ pie_chart_data|escapejs }}');

        new Chart(pieCtx, {
            type: 'pie',
            data: pieChartData,
            options: { responsive: true }
        });

        // BAR CHART
        const barCtx = document.getElementById('barChart').getContext('2d');
        const barChartData = JSON.parse('{{ bar_chart_data|escapejs }}');

        new Chart(barCtx, {
            type: 'bar',
            data: barChartData,
            options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });
    });
</script>
{% endblock %}
